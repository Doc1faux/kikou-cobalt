<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <link rel="stylesheet" href="style.css"/>
    <title>Team List</title>
</head>
<body>
<ul id="teamlist">
</ul>

<script type="text/javascript" src="../platform/cobalt.js"></script>
<script type="text/javascript" src="app.js"></script>
<script>



    

    function showForm(){
            cobalt.storage.set('selectedMate', { id: this.id, name: this.innerHTML });
            cobalt.webLayer("show","team_actions.html");
        }

    function displayList(peoples){
        

        var teamList = document.getElementById("teamlist");
        teamList.innerHTML = ''; //clean

        peoples.forEach(function(people) {
          var li = document.createElement("li");
          li.id = people.id;
          li.onclick = showForm;
          li.innerHTML = people.name;
          teamList.appendChild(li);
        });

        // for (var j = 0; j < peoples.length; j++) {
        //   var li = document.createElement("li");
        //   li.id = peoples[j].id;
        //   li.onclick = showForm;
        //   li.innerHTML = peoples[j].name;
        //   teamList.appendChild(li);
        // }

    }

    function handleEvent(data)  {

        if (data){
            cobalt.log(data);
            var people = data.people;

            switch (data.action) {

                    case "rename":
                        TeamList.save(people);
                        break;
                    case "remove":
                        TeamList.remove(people.id);
                        break;
                    case "add":
                        TeamList.save(people);
                        break;
                    default :
                        cobalt.log('unknown action.');
                        break;
            }
        }
        


        var peoples = TeamList.getAll();
        cobalt.log(peoples);
        if (typeof peoples == 'undefined') {
            peoples = [];
        }

        displayList(peoples);




    }


    document.addEventListener("DOMContentLoaded", function() {

        cobalt.init({
            debug: true,
            //debugInBrowser:true,
            events: {
                onPageShown: function (data, callback) {
                    cobalt.log('Display Team List...');
                    init();
                    handleEvent(data);
                },
                onWebLayerDismissed : function( data, callback ){
                    init();
                    handleEvent(data.data);
                }
            }
        });

        function init(){
            cobalt.nativeBars.setActionVisible("team_add", true);
            cobalt.nativeBars.setActionVisible("team_list", false);
            cobalt.nativeBars.setBarContent({
                "title": "Team List"
            });

        }
           

        
        

        cobalt.nativeBars.setEventListener(function (item, event) {
            switch (item) {
                case "team_add":
                    cobalt.navigate.push({ page : "team_add.html"});
                    break;
                default :
                    cobalt.log('An unknown button has been pressed.');
                    break;
            }
        });

        

        //cobalt.events.onPageShown();
        //displayList();



    });

</script>
</body>
</html>
