<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
<h1>build your teams randomly!</h1>
<div>
    <label for="nb">
        <select id="nb">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
        </select>
        <button id="ok">OK</button>
    </label>
</div>
<div id="team-list">
</div>

<script type="text/javascript" src="../platform/cobalt.js"></script>
<script>
    cobalt.init({
        debug: true
        //debugInBrowser:true,
    });

   


   var team_list_bar = {
        "visible": { "top" : true },
        "title": "Team List",
        "color" : "#FF69B4",
        "backgroundColor": "#FFF",
        "actions": [
            {
                "name": "team_add",
                "title": "add a team member",
                "icon" : "fa fa-plus",
                "iosPosition": "topRight",
                "androidPosition": "top"
            }
        ]
    }

    cobalt.nativeBars.setActionVisible("home", false);
    cobalt.nativeBars.setActionVisible("team_add", false);

    cobalt.nativeBars.setEventListener(function (item, event) {
            cobalt.log(item);
            switch (item) {
                case "team_list":
                  // cobalt.navigate.push({ page : "team_list.html", bars : team_list_bar });
                  cobalt.navigate.push({ page : "team_list.html" });
                    break;
                default :
                    barLog('An unknown button has been pressed.');
                    break;
            }
        });


    var findPeoples = function() {
        
        //work with a copy of initial list
        var peoplesTemp = peoples.slice();
        
        var nbPers = document.getElementById("txt-loto-nb").value;
        //to avoid infinite loop
        if (nbPers.length === 0) return;
        
        var team = [nbPers];
        for (var i=0; i < nbPers;i++){
           var n = Math.floor(Math.random() * (peoplesTemp.length - 1));
           team[i] = peoplesTemp.splice(n, 1);
           
        }
       
        //clear all:
        document.getElementById("team-list").innerHTML = '';
        displayTeam(team, "Hall of fame:");
        
        
      }


    var generateTeams = function() {
        var peoples = cobalt.storage.get('peoples');
        //work with a copy of initial list
        var peoplesTemp = peoples.slice();
        var nbPers = document.getElementById("nb").value;
        //to avoid infinite loop
        if (nbPers.length === 0) return;
        var nbTeam = Math.floor(peoples.length / nbPers);
        console.log("nbPers:" + nbPers + " - nbTeam:" + nbTeam);
        var teams = [nbTeam];
        for (var i = 0; i < nbTeam; i++) {
          
          var team = [nbPers];
          for (var j = 0; j < nbPers; j++) {
            var n = Math.floor(Math.random() * (peoplesTemp.length - 1));
            team[j] = peoplesTemp.splice(n, 1);
          }
          teams[i] = team;
        }
        displayTeams(teams);
        //display orphans
        if (peoplesTemp.length>0) {
            displayTeam(peoplesTemp, "Team Orphan(s)");
        }
        
      }
      var displayTeams = function(teams) {
        //clear all:
        document.getElementById("team-list").innerHTML = '';
        for (var i = 0; i < teams.length; i++) {
          displayTeam(teams[i], "Team " + i);
        }
      }
      var displayTeam = function(team, name) {
        var teamList = document.getElementById("team-list");
        //title
        var title = document.createElement("h3");
        title.innerHTML = name;
        teamList.appendChild(title);
        var ul = document.createElement("ul");
        for (var j = 0; j < team.length; j++) {
          var li = document.createElement("li");
          li.innerHTML = team[j];
          ul.appendChild(li);
        }
        teamList.appendChild(ul);
      }


    document.getElementById('ok').addEventListener('click', generateTeams);
</script>
</body>
</html>
